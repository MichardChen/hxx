<!DOCTYPE html>
<html>
<head>
	<title>订单数据统计</title>
	#parse("sys/header.html")
	<!-- 引入 echarts.js -->
	<script src="${rc.contextPath}/statics/libs/echarts.min.js"></script>
	<script src="${rc.contextPath}/statics/libs/moment.js"></script>
	<script src="${rc.contextPath}/statics/libs/moment-with-locales.js"></script>
	<link href="${rc.contextPath}/statics/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
	<script src="${rc.contextPath}/statics/libs/bootstrap-datetimepicker.min.js"></script>
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div class="row">
	<div class='col-sm-3'>
		<div class="form-group">
			<label>选择开始时间：</label>
			<!--指定 date标记-->
			<div class='input-group date' id='startDate-datetimepicker'>
				<input type='text' class="form-control" id="startDate"/>
				<span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
			</div>
		</div>
	</div>
	<div class='col-sm-3'>
		<div class="form-group">
			<label>选择结束时间：</label>
			<!--指定 date标记-->
			<div class='input-group date' id='endDate-datetimepicker'>
				<input type='text' class="form-control" id="endDate"/>
				<span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
			</div>
		</div>
	</div>
	<div class='col-sm-3'>
		<button type="button" class="btn btn-info" onclick="loadData()" style="margin-top:25px;"><i class="fa fa-search" aria-hidden="true"></i>查询</button>
		<input type="button" class="btn btn-primary" onclick="reset()" value="重置" style="margin-top:25px;"/>
	</div>
</div>
<div id="order_type_report_count" style="width: 600px;height:400px; padding: 10px"></div>
<div id="order_type_report_amount" style="width: 600px;height:400px; padding: 10px"></div>
<div id="order_type_report_status_count" style="width: 600px;height:400px; padding: 10px"></div>
<script type="text/javascript">
	$('#startDate-datetimepicker').datetimepicker({
		format: 'YYYY-MM-DD',
		locale: moment.locale('zh-cn')
	});
	$('#endDate-datetimepicker').datetimepicker({
		format: 'YYYY-MM-DD',
		locale: moment.locale('zh-cn')
	});
	//重置查询参数
	function reset(){
		$('#startDate').val(null);
		$('#endDate').val(null);
		loadData();
	}
	//加载数据
	function loadData() {
		var param = {
			"startDate": $('#startDate').val(),
			"endDate": $('#endDate').val()
		}
		$.ajax({
			type: "POST",
			url: "../tfishorder/getReportData",
			contentType : 'application/x-www-form-urlencoded',
			dataType:'json',
			data: param,
			success: function(r){
				if(r.code == 0){
					//根据product_type分类统计有多少订单量
					// 基于准备好的dom，初始化echarts实例，订单状态下的订单数量
					if(r.result.typeCount && r.result.typeCount.series){
						for(var i=0; i<r.result.typeCount.series.length;i++){
							r.result.typeCount.series[i].itemStyle ={ normal: {label : {show: true}}};
							// r.result.typeCount.series[i].label= { normal: { formatter: '{b}:{c}笔'}};
						}
					}
					var order_type_report_count_chart = echarts.init(document.getElementById('order_type_report_count'));
					var order_type_report_count_option = {
						title: {
							text: '订单分类数量统计图'+ (r.result.typeCount?"":"(暂无数据)")
						},
						toolbox: {
							show: true,
							feature: {
								saveAsImage: {
									show:true,
									excludeComponents :['toolbox'],
									pixelRatio: 2
								}
							}
						},
						//用formatter回调函数显示单项数据内容
						tooltip: {
							trigger: 'item',
							formatter: function (params) {
								var color = params.color;//图例颜色
								var htmlStr ='<div>';
								htmlStr += params.name + '<br/>';//x轴的名称
								//为了保证和原来的效果一样，这里自己实现了一个点的效果
								htmlStr += '<span style="margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:'+color+';"></span>';
								//添加一个汉字，这里你可以格式你的数字或者自定义文本内容
								htmlStr += params.seriesName + '：'+params.value + '笔';
								htmlStr += '</div>';
								return htmlStr;
							}
						},
						legend: {
							data: (r.result.typeCount?r.result.typeCount.yAxis:[])
						},
						xAxis: {
							data: (r.result.typeCount?r.result.typeCount.xAxis:[])
						},
						yAxis: {},
						itemStyle : {
							normal: {
								label : {
									show: true
								}
							}
						},
						series: (r.result.typeCount?r.result.typeCount.series:[])
					};
					// 使用刚指定的配置项和数据显示图表。
					order_type_report_count_chart.clear();
					order_type_report_count_chart.setOption(order_type_report_count_option);

					//根据product_type分类统计订单总金额(预付款+尾款)
					// 基于准备好的dom，初始化echarts实例，订单分类数量统计
					if(r.result.typeAmount && r.result.typeAmount.series){
						for(var i=0; i<r.result.typeAmount.series.length;i++){
							r.result.typeAmount.series[i].itemStyle={ normal: {label : {show: true}}};
							// r.result.typeAmount.series[i].label= { normal: { formatter: '{b}:{c}元'}};
						}
					}
					var order_type_report_amount_chart = echarts.init(document.getElementById('order_type_report_amount'));
					var order_type_report_amount_option = {
						title: {
							text: '订单分类总金额统计图'+ (r.result.typeAmount?"":"(暂无数据)")
						},
						//用formatter回调函数显示单项数据内容
						tooltip: {
							trigger: 'item',
							formatter: function (params) {
								var color = params.color;//图例颜色
								var htmlStr ='<div>';
								htmlStr += params.name + '<br/>';//x轴的名称
								//为了保证和原来的效果一样，这里自己实现了一个点的效果
								htmlStr += '<span style="margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:'+color+';"></span>';
								//添加一个汉字，这里你可以格式你的数字或者自定义文本内容
								htmlStr += params.seriesName + '：'+params.value;
								htmlStr += '</div>';
								return htmlStr;
							}
						},
						legend: {
							data: (r.result.typeAmount?r.result.typeAmount.yAxis:[])
						},
						xAxis: {
							data: (r.result.typeAmount?r.result.typeAmount.xAxis:[])
						},
						yAxis: {},
						itemStyle : {
							normal: {
								label : {
									show: true
								}
							}
						},
						series: (r.result.typeAmount?r.result.typeAmount.series:[])
					};
					// 使用刚指定的配置项和数据显示图表。
					order_type_report_amount_chart.clear();
					order_type_report_amount_chart.setOption(order_type_report_amount_option);

					// 基于准备好的dom，初始化echarts实例，订单状态下的订单数量
					var order_type_report_status_count_chart = echarts.init(document.getElementById('order_type_report_status_count'));
					// 指定图表的配置项和数据
					var order_type_report_status_count_option = {
						title: {
							text: '订单各状态数量统计图'+ (r.result.statusCount?"":"(暂无数据)")
						},
						tooltip: {},
						legend: {
							data:['订单状态']
						},
						xAxis: {
							data: (r.result.statusCount?r.result.statusCount.xAxis:[])
						},
						yAxis: {},
						itemStyle : {
							normal: {
								label : {
									show: true
								}
							}
						},
						series: (r.result.statusCount?[{
							name: '订单状态',
							type: 'line',
							data: r.result.statusCount.series,
							itemStyle : { normal: {label : {show: true}}},
							label: { normal: { formatter: '{b}:{c}笔'}}
						}]:[]),
						toolbox: {
							show: true,
							right:30,
							itenGap:20,
							feature: {
								saveAsImage: {
									show: true,
									excludeComponents: ['toolbox'],
									pixelRatio: 2
								}
							}
						}
					};
					// 使用刚指定的配置项和数据显示图表。
					order_type_report_status_count_chart.clear();
					order_type_report_status_count_chart.setOption(order_type_report_status_count_option);
				}else{
					alert(r.msg);
				}
			}
		});
	}
	loadData();
</script>
</body>
</html>