<!DOCTYPE html>
<html>
<head>
	<title>用户数据统计表</title>
	#parse("sys/header.html")
	<!-- 引入 echarts.js -->
	<script src="${rc.contextPath}/statics/libs/echarts.min.js"></script>
	<script src="${rc.contextPath}/statics/libs/moment.js"></script>
	<script src="${rc.contextPath}/statics/libs/moment-with-locales.js"></script>
	<link href="${rc.contextPath}/statics/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
	<script src="${rc.contextPath}/statics/libs/bootstrap-datetimepicker.min.js"></script>
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div class="row">
	<div class='col-sm-3'>
		<div class="form-group">
			<label>选择开始时间：</label>
			<!--指定 date标记-->
			<div class='input-group date' id='startDate-datetimepicker'>
				<input type='text' class="form-control" id="startDate"/>
				<span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
			</div>
		</div>
	</div>
	<div class='col-sm-3'>
		<div class="form-group">
			<label>选择结束时间：</label>
			<!--指定 date标记-->
			<div class='input-group date' id='endDate-datetimepicker'>
				<input type='text' class="form-control" id="endDate"/>
				<span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
			</div>
		</div>
	</div>
	<div class='col-sm-3'>
		<button type="button" class="btn btn-info" onclick="loadData()" style="margin-top:25px;"><i class="fa fa-search" aria-hidden="true"></i>查询</button>
		<input type="button" class="btn btn-primary" onclick="reset()" value="重置" style="margin-top:25px;"/>
	</div>
</div>
<div id="member_register_count" style="width: 600px;height:400px; padding: 10px"></div>
<script type="text/javascript">
	$('#startDate-datetimepicker').datetimepicker({
		format: 'YYYY-MM-DD',
		locale: moment.locale('zh-cn')
	});
	$('#endDate-datetimepicker').datetimepicker({
		format: 'YYYY-MM-DD',
		locale: moment.locale('zh-cn')
	});
	//重置查询参数
	function reset(){
		$('#startDate').val(null);
		$('#endDate').val(null);
		loadData();
	}
	//导出excel
	function exportExcel(type){
		var url = "../basic/member/exportExcel?startDate="
				+$('#startDate').val()
				+"&endDate="+$('#endDate').val()
				+"&type="+type;
		window.open(url);
	}
	//加载数据
	function loadData() {
		var param = {
			"startDate": $('#startDate').val(),
			"endDate": $('#endDate').val()
		}
		$.ajax({
			type: "POST",
			url: "../basic/member/getReportData",
			contentType : 'application/x-www-form-urlencoded',
			dataType:'json',
			data: param,
			success: function(r){
				if(r.code == 0){
					// 基于准备好的dom，初始化echarts实例，订单状态下的订单数量
					var member_register_count_chart = echarts.init(document.getElementById('member_register_count'));
					// 指定图表的配置项和数据
					var member_register_count_option = {
						title: {
							text: '每日注册用户数量统计图' + (r.result.registerCount?"":"(暂无数据)")
						},
						//用formatter回调函数显示单项数据内容
						tooltip: {
							trigger: 'item',
							formatter: function (params) {
								var color = params.color;//图例颜色
								var htmlStr ='<div>';
								htmlStr += params.name + '<br/>';//x轴的名称
								//为了保证和原来的效果一样，这里自己实现了一个点的效果
								htmlStr += '<span style="margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:'+color+';"></span>';
								//添加一个汉字，这里你可以格式你的数字或者自定义文本内容
								htmlStr += params.seriesName + '：'+params.value+ '个';
								htmlStr += '</div>';
								return htmlStr;
							}
						},
						legend: {
							data:['用户数量']
						},
						toolbox: {
							show: r.result.registerCount,
							feature: {
								myTool1: {
									show: true,
									title: '导出Excel',
									icon: 'path://M432.45,595.444c0,2.177-4.661,6.82-11.305,6.82c-6.475,0-11.306-4.567-11.306-6.82s4.852-6.812,11.306-6.812C427.841,588.632,432.452,593.191,432.45,595.444L432.45,595.444z M421.155,589.876c-3.009,0-5.448,2.495-5.448,5.572s2.439,5.572,5.448,5.572c3.01,0,5.449-2.495,5.449-5.572C426.604,592.371,424.165,589.876,421.155,589.876L421.155,589.876z M421.146,591.891c-1.916,0-3.47,1.589-3.47,3.549c0,1.959,1.554,3.548,3.47,3.548s3.469-1.589,3.469-3.548C424.614,593.479,423.062,591.891,421.146,591.891L421.146,591.891zM421.146,591.891',
									onclick: function (){
										exportExcel(null);
									}
								}
							}
						},
						xAxis: {
							data: (r.result.registerCount?r.result.registerCount.xAxis:[])
						},
						yAxis: {},
						itemStyle : {
							normal: {
								label : {
									show: true
								}
							}
						},
						series: (r.result.registerCount?[{
							name: '用户数量',
							type: 'line',
							data: r.result.registerCount.series,
							itemStyle : { normal: {label : {show: true}}},
							label: { normal: { formatter: '{c}个'}}
						}]:[])
					};
					// 使用刚指定的配置项和数据显示图表。
					member_register_count_chart.clear();
					member_register_count_chart.setOption(member_register_count_option);
				}else{
					alert(r.msg);
				}
			}
		});
	}
	loadData();
</script>
</body>
</html>